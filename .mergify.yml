queue_rules:
  - name: default
    merge_conditions:
      - "#approved-reviews-by>=1"
      - check-success=Pipelines as Code CI / unit
      - label=staging-ci-complete
    priority_rules:
      - name: rollback
        conditions:
          - label=rollback
        priority: high

pull_request_rules:
  - name: automatic merge of rollback
    conditions:
      - check-success=Pipelines as Code CI / unit
      - "#approved-reviews-by>=1"
      - base=master
      - -files~=^[^\/]+\/staging\/?(?:[^\/]+\/?)*$
      - label=staging-ci-in-progress
      - label=rollback
    actions:
      queue:
        method: merge
  - name: automatic merge of staging file change
    conditions:
      - "#approved-reviews-by>=1"
      - base=master
      - check-success=Pipelines as Code CI / unit
      - -files~=^[^/]+/staging/?(?:[^/]+/?)*$
      - label=staging-ci-in-progress
    actions:
      queue:
        method: merge
  - name: automatic merge for other changes not related to staging
    conditions:
      - "#approved-reviews-by>=1"
      - base=master
      - check-success=Pipelines as Code CI / unit
    actions:
      merge:
        method: merge
